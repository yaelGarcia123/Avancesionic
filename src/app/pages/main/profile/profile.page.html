<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>My Profile</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Floating action button -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="toggleEdit()">
      <ion-icon [name]="isEditing ? 'close' : 'create'"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <div class="user-crud-container">
    <!-- Display user data -->
    <div *ngIf="!isEditing && userData" class="user-profile"><!--Only show if isEditing = false -->
      <ion-card>
        <ion-card-header>
          <ion-card-title>My Profile</ion-card-title>
          <ion-card-subtitle>Account information</ion-card-subtitle>
        </ion-card-header>

        <ion-card-content>
          <ion-list lines="none">
            <ion-item>
              <ion-icon
                name="person-outline"
                slot="start"
                color="primary"
              ></ion-icon>
              <ion-label>
                <h3>Name</h3>
                <p>{{ userData.name }}</p>
              </ion-label>
            </ion-item>

            <ion-item>
              <ion-icon
                name="mail-outline"
                slot="start"
                color="primary"
              ></ion-icon>
              <ion-label>
                <h3>Email</h3>
                <p>{{ userData.email }}</p>
              </ion-label>
            </ion-item>

            <ion-item>
              <ion-icon
                name="key-outline"
                slot="start"
                color="primary"
              ></ion-icon>
              <ion-label>
                <h3>UID</h3>
                <p>{{ userData.uid }}</p>
              </ion-label>
            </ion-item>
          </ion-list>

          <!-- Button to toggle edit mode -->
          <ion-button expand="block" color="primary" (click)="toggleEdit()">
            <ion-icon slot="start" name="create-outline"></ion-icon>
            Edit Profile
          </ion-button>

          <!-- Logout button -->
          <ion-button expand="block" color="danger" (click)="logout()">
            <ion-icon slot="start" name="log-out-outline"></ion-icon>
            Logout
          </ion-button>

        </ion-card-content>
      </ion-card>
    </div>

    <!-- Edit form -->
    <div *ngIf="isEditing && userData" class="edit-form">
      <ion-card>
        <ion-card-header>
          <ion-card-title>Edit Profile</ion-card-title>
          <ion-card-subtitle>Update your information</ion-card-subtitle>
        </ion-card-header>

        <ion-card-content>
          <form [formGroup]="userForm" (ngSubmit)="saveChanges()">
            <!-- Name input -->
            <ion-item>
              <ion-label position="stacked">Name</ion-label>
              <ion-input formControlName="name" type="text"></ion-input>
            </ion-item>

            <!-- Email input -->
            <ion-item>
              <ion-label position="stacked">Email</ion-label>
              <ion-input formControlName="email" type="email"></ion-input>
            </ion-item>

            <!-- Current password -->
            <ion-item>
              <ion-label position="stacked">Current password (required to edit info)</ion-label>
              <ion-input
                formControlName="currentPassword"
                type="password"
              ></ion-input>
            </ion-item>

            <!-- New password -->
            <ion-item>
              <ion-label position="stacked">New password (optional)</ion-label>
              <ion-input formControlName="password" type="password"></ion-input>
            </ion-item>
            <ion-note color="medium">
              Leave blank if you do not want to change the password
            </ion-note>

            <!-- Form action buttons -->
            <div class="form-buttons">
              <ion-button
                expand="block"
                color="primary"
                type="submit"
                [disabled]="!userForm.valid"
              >
                <ion-icon slot="start" name="save-outline"></ion-icon>
                Save Changes
              </ion-button>

              <ion-button
                expand="block"
                color="medium"
                fill="outline"
                (click)="cancelEdit()"
              >
                <ion-icon slot="start" name="close-outline"></ion-icon>
                Cancel
              </ion-button>

              <ion-button
                expand="block"
                color="danger"
                fill="outline"
                (click)="confirmDelete()"
              >
                <ion-icon slot="start" name="trash-outline"></ion-icon>
                Delete Account
              </ion-button>
            </div>
          </form>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Loading state -->
    <div *ngIf="!userData" class="loading">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Loading user information...</p>
    </div>
  </div>
</ion-content>
